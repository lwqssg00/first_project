<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sz.mapper.AppInfoMapper">
  <resultMap id="BaseResultMap" type="com.sz.pojo.AppInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="software_name" jdbcType="VARCHAR" property="softwareName" />
    <result column="apk_name" jdbcType="VARCHAR" property="apkName" />
    <result column="support_trom" jdbcType="VARCHAR" property="supportTrom" />
    <result column="interface_language" jdbcType="VARCHAR" property="interfaceLanguage" />
    <result column="software_size" jdbcType="DECIMAL" property="softwareSize" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="dev_id" jdbcType="BIGINT" property="devId" />
    <result column="app_info" jdbcType="VARCHAR" property="appInfo" />
    <result column="status" jdbcType="BIGINT" property="status" />
    <result column="onsale_date" jdbcType="TIMESTAMP" property="onsaleDate" />
    <result column="offsale_date" jdbcType="TIMESTAMP" property="offsaleDate" />
    <result column="flatfrom_id" jdbcType="BIGINT" property="flatfromId" />
    <result column="category_level3" jdbcType="BIGINT" property="categoryLevel3" />
    <result column="down_loads" jdbcType="BIGINT" property="downLoads" />
    <result column="created_by" jdbcType="BIGINT" property="createdBy" />
    <result column="creation_date" jdbcType="TIMESTAMP" property="creationDate" />
    <result column="modify_by" jdbcType="BIGINT" property="modifyBy" />
    <result column="modify_datee" jdbcType="TIMESTAMP" property="modifyDatee" />
    <result column="category_level1" jdbcType="BIGINT" property="categoryLevel1" />
    <result column="category_level2" jdbcType="BIGINT" property="categoryLevel2" />
    <result column="logopic_path" jdbcType="VARCHAR" property="logopicPath" />
    <result column="logoloc_path" jdbcType="VARCHAR" property="logolocPath" />
    <result column="version_id" jdbcType="BIGINT" property="versionId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, software_name, apk_name, support_trom, interface_language, software_size, update_date, 
    dev_id, app_info, status, onsale_date, offsale_date, flatfrom_id, category_level3, 
    down_loads, created_by, creation_date, modify_by, modify_datee, category_level1, 
    category_level2, logopic_path, logoloc_path, version_id
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from app_info
    where id = #{id,jdbcType=BIGINT}
  </select>


  <update id="updateByPrimaryKey" parameterType="com.sz.pojo.AppInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update app_info
    set software_name = #{softwareName,jdbcType=VARCHAR},
      apk_name = #{apkName,jdbcType=VARCHAR},
      support_trom = #{supportTrom,jdbcType=VARCHAR},
      interface_language = #{interfaceLanguage,jdbcType=VARCHAR},
      software_size = #{softwareSize,jdbcType=DECIMAL},
      update_date = #{updateDate,jdbcType=TIMESTAMP},
      dev_id = #{devId,jdbcType=BIGINT},
      app_info = #{appInfo,jdbcType=VARCHAR},
      status = #{status,jdbcType=BIGINT},
      onsale_date = #{onsaleDate,jdbcType=TIMESTAMP},
      offsale_date = #{offsaleDate,jdbcType=TIMESTAMP},
      flatfrom_id = #{flatfromId,jdbcType=BIGINT},
      category_level3 = #{categoryLevel3,jdbcType=BIGINT},
      down_loads = #{downLoads,jdbcType=BIGINT},
      created_by = #{createdBy,jdbcType=BIGINT},
      creation_date = #{creationDate,jdbcType=TIMESTAMP},
      modify_by = #{modifyBy,jdbcType=BIGINT},
      modify_datee = #{modifyDatee,jdbcType=TIMESTAMP},
      category_level1 = #{categoryLevel1,jdbcType=BIGINT},
      category_level2 = #{categoryLevel2,jdbcType=BIGINT},
      logopic_path = #{logopicPath,jdbcType=VARCHAR},
      logoloc_path = #{logolocPath,jdbcType=VARCHAR},
      version_id = #{versionId,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>


  <!--<resultMap id="base" type="com.sz.pojo.AppInfo">-->
    <!--<id property="id" column="appId" />-->
    <!--<result property="softwareName" column="software_name" />-->
    <!--<result property="apkName" column="apk_name" />-->
    <!--<result property="softwareSize" column="software_size" />-->
    <!--<result property="flatfromId" column="flatfrom_id" />-->
    <!--<result property="status" column="status" />-->
    <!--<result property="downLoads" column="down_loads" />-->
  <!--</resultMap>-->
  <!--<resultMap id="appInfo" type="com.sz.pojo.AppInfo" extends="base">-->
      <!--<association property="newAppVersion" javaType="com.sz.pojo.AppVersion">-->
        <!--<id property="id" column="version_id"/>-->
        <!--<result property="versionNo" column="version_no"/>-->
      <!--</association>-->
      <!--<association property="appCategorylevel1" javaType="com.sz.pojo.AppCategory">-->
          <!--<result property="categoryName" column="categoryLevel1Name"/>-->
      <!--</association>-->
    <!--<association property="appCategorylevel2" javaType="com.sz.pojo.AppCategory">-->
      <!--<result property="categoryName" column="categoryLeve21Name"/>-->
    <!--</association>-->
    <!--<association property="appCategorylevel3" javaType="com.sz.pojo.AppCategory">-->
      <!--<result property="categoryName" column="categoryLevel3Name"/>-->
    <!--</association>-->
  <!--</resultMap>-->

  <resultMap id="base" type="com.sz.pojo.AppInfo">
    <id property="id" column="appId" />
    <result property="softwareName" column="software_name" />
    <result property="apkName" column="apk_name" />
    <result property="softwareSize" column="software_size" />
    <result property="flatfromId" column="flatfrom_id" />
      <result property="supportTrom" column="support_trom" />
    <result property="status" column="status" />
    <result property="downLoads" column="down_loads" />
      <result property="interfaceLanguage" column="interface_language"/>
  </resultMap>

    <resultMap id="appInfobyId" type="com.sz.pojo.AppInfo" extends="base">
        <result column="update_date" property="updateDate"/>
        <result column="logoloc_path" property="logolocPath" />
        <result column="logopic_path" property="logopicPath" />
        <result  column="creation_date" property="creationDate"/>
        <result column="app_info" property="appInfo"/>
        <result  column="onsale_date" property="onsaleDate"/>

        <result column="offsale_date" property="offsaleDate"/>
        <association property="appCategorylevel1" javaType="com.sz.pojo.AppCategory">
                <id column="levelOneId" property="id" />
                <result column="levelName1" property="categoryName"/>
        </association>
        <association property="appCategorylevel2" javaType="com.sz.pojo.AppCategory">
            <id column="levelTwoId" property="id" />
            <result column="levelName2" property="categoryName"/>
        </association>
        <association property="appCategorylevel3" javaType="com.sz.pojo.AppCategory">
            <id column="levelThreeId" property="id" />
            <result column="levelName3" property="categoryName"/>
        </association>
        <association property="appUntilObj" javaType="com.sz.obj.AppUntilObj">
            <result column="statuId" property="appStatus" />
            <result column="statuName" property="appStatusName" />
            <result column="flatfromId" property="appType"/>
            <result column="flatfromName" property="appStatusName"/>
        </association>
        <association property="modifyUser" javaType="com.sz.pojo.DevUser">
                <id column="modifyId" property="id" />
            <result column="modifyName" property="devName" />
        </association>
        <association property="createUser" javaType="com.sz.pojo.DevUser">
                <id column="createId" property="id" />
                <result column="createName" property="devName" />
        </association>
        <association property="devUser" javaType="com.sz.pojo.DevUser">
                <id column="devId" property="id"/>
            <result column="devName" property="devName" />
        </association>
        <association property="newAppVersion" javaType="com.sz.pojo.AppVersion">
                <id column="versionId" property="id" />
            <result column="version_no" property="versionNo" />
        </association>
    </resultMap>
    
    <resultMap id="appInfoWithHistory" type="com.sz.pojo.AppInfo" extends="appInfobyId">
        <collection property="appVersions" ofType="com.sz.pojo.AppVersion">
            <id property="id" column="historyId" />
            <result property="versionNo" column="historyVersionNo" />
            <result property="versionInfo" column="historyVersioinInfo" />
            <result  property="publishStatus" column="historyPublishStatus"/>
            <result property="downloadLink" column="historyDownLoadLink" />
            <result property="versionSize" column="historyVersionSize"/>
            <result property="apklocPath" column="historyapkLocPath" />
            <result  property="apkFilename" column="historyApkFileName"/>
        </collection>
    </resultMap>

  <resultMap id="appInfo" type="com.sz.pojo.AppInfo" extends="base">
    <association property="newAppVersion" javaType="com.sz.pojo.AppVersion">
      <id property="id" column="version_id"/>
      <result property="versionNo" column="version_no"/>
    </association>
    <association property="appCategorylevel1" javaType="com.sz.pojo.AppCategory">
      <result property="categoryName" column="categoryLevel1Name"/>
    </association>
    <association property="appCategorylevel2" javaType="com.sz.pojo.AppCategory">
      <result property="categoryName" column="categoryLevel2Name"/>
    </association>
    <association property="appCategorylevel3" javaType="com.sz.pojo.AppCategory">
      <result property="categoryName" column="categoryLevel3Name"/>
    </association>
    <association property="appUntilObj" javaType="com.sz.obj.AppUntilObj">
      <result property="appTypeName" column="appTypeName" />
      <result property="appStatusName" column="appStatusName"/>
    </association>
  </resultMap>


  <!--<select id="queryByDevUseId" resultMap="appInfo" parameterType="java.lang.Long">-->
          <!--SELECT-->
          <!--t1.id as appId,-->
          <!--t1.software_name,-->
          <!--t1.apk_name,-->
          <!--t1.software_size,-->
          <!--t1.software_name,-->
          <!--t1.flatfrom_id,-->
          <!--t1.`status`,-->
          <!--t1.version_id,-->
          <!--t1.down_loads,-->
          <!--tc1.category_name AS categoryLevel1Name,-->
          <!--tc2.category_name AS categoryLevel2Name,-->
          <!--tc3.category_name AS categoryLevel3Name,-->
          <!--t3.version_no-->
      <!--FROM-->
          <!--app_info t1-->
      <!--LEFT JOIN app_category tc1 ON t1.category_level1 = tc1.id-->
      <!--LEFT JOIN app_category tc2 ON t1.category_level2 = tc2.id-->
      <!--LEFT JOIN app_category tc3 ON t1.category_level3 = tc3.id-->
      <!--LEFT JOIN app_version t3 ON t1.version_id = t3.id,dev_user t4-->
      <!--WHERE t1.dev_id =t4.id and t4.id =#{id}-->
  <!--</select>-->
    <select id="queryByALL" resultMap="appInfo">
   SELECT
    t1.id as appId,
    t1.apk_name,
    t1.support_trom,
    t1.software_size,
    t1.software_name,
    t1.flatfrom_id,
    t1.`status`,
    t1.version_id,
    t1.down_loads,
    t1.interface_language,
    tc1.category_name AS categoryLevel1Name,
    tc2.category_name AS categoryLevel2Name,
    tc3.category_name AS categoryLevel3Name,
	td1.value_name As appStatusName,
	td2.value_name	As appTypeName,
    t3.version_no
    FROM
    app_info t1
    LEFT JOIN app_category tc1 ON t1.category_level1 = tc1.id
    LEFT JOIN app_category tc2 ON t1.category_level2 = tc2.id
    LEFT JOIN app_category tc3 ON t1.category_level3 = tc3.id
	LEFT JOIN data_dictionary td1 ON t1.`status` = td1.value_id
    LEFT JOIN data_dictionary td2 ON t1.flatfrom_id = td2.value_id
    LEFT JOIN app_version t3 ON t1.version_id = t3.id
    LEFT JOIN dev_user t4 ON t1.dev_id = t4.id
    <where>
      t4.id =#{id}
      and td1.type_code='APP_STATUS' and td2.type_code='APP_FLATORM'
      <if test="appUsername !=null and appUsername !=''">
        and t1.software_name LIKE CONCAT('%',#{appUsername},'%')
      </if>
      <if test="appStatus !=null and appStatus!=''">
        and t1.status=#{appStatus}
      </if>
      <if test="appType !=null and appType!='' ">
        and t1.flatfrom_id=#{appType}
      </if>
      <if test="categoriesOne !=null and categoriesOne!=''">
        and t1.category_level1 =#{categoriesOne}
      </if>
      <if test="categoriesTwo !=null and categoriesTwo!='' ">
        and t1.category_level2 =#{categoriesTwo}
      </if>
      <if test="categoriesThree !=null and categoriesThree!=''">
        and t1.category_level3 =#{categoriesThree}
      </if>
    </where>
  </select>
    <insert id="add" parameterType="com.sz.pojo.AppInfo">
        insert into app_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="softwareName != null and softwareName !=''">
                software_name,
            </if>
            <if test="apkName != null and apkName !=''">
                apk_name,
            </if>
            <if test="supportTrom != null  and supportTrom !=''">
                support_trom,
            </if>
            <if test="interfaceLanguage != null and interfaceLanguage !=''">
                interface_language,
            </if>
            <if test="softwareSize != null">
                software_size,
            </if>
            <if test="updateDate != null">
                update_date,
            </if>
            <if test="devUser != null and devUser.id !=null">
                dev_id,
            </if>
            <if test="appInfo != null and appInfo !=''">
                app_info,
            </if>
            <if test="appUntilObj != null and appUntilObj.appStatus !=null ">
                status,
            </if>
            <if test="onsaleDate != null">
                onsale_date,
            </if>
            <if test="offsaleDate != null">
                offsale_date,
            </if>
            <if test="appUntilObj != null and appUntilObj.appType !=null">
                flatfrom_id,
            </if>
            <if test="appCategorylevel3 != null and appCategorylevel3.id !=null">
                category_level3,
            </if>
            <if test="downLoads != null">
                down_loads,
            </if>
            <if test="devUser != null and devUser.id !=null">
                created_by,
            </if>
            <if test="creationDate != null">
                creation_date,
            </if>
            <if test="modifyBy != null">
                modify_by,
            </if>
            <if test="modifyDatee != null">
                modify_datee,
            </if>
            <if test="appCategorylevel1 != null and appCategorylevel1.id !=null">
                category_level1,
            </if>
            <if test="appCategorylevel2 !=null and appCategorylevel2.id  != null">
                category_level2,
            </if>
            <if test="logopicPath != null">
                logopic_path,
            </if>
            <if test="logolocPath != null">
                logoloc_path,
            </if>
            <if test="newAppVersion != null and newAppVersion.id !=null">
                version_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="softwareName != null and softwareName !=''">
                #{softwareName,jdbcType=VARCHAR},
            </if>
            <if test="apkName != null and apkName !=''">
                #{apkName,jdbcType=VARCHAR},
            </if>
            <if test="supportTrom != null and supportTrom !=''">
                #{supportTrom,jdbcType=VARCHAR},
            </if>
            <if test="interfaceLanguage != null and interfaceLanguage !=''">
                #{interfaceLanguage,jdbcType=VARCHAR},
            </if>
            <if test="softwareSize != null">
                #{softwareSize,jdbcType=DECIMAL},
            </if>
            <if test="updateDate != null">
                #{updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="devUser != null and devUser.id !=null">
                #{devUser.id,jdbcType=BIGINT},
            </if>
            <if test="appInfo != null and appInfo !=''">
                #{appInfo,jdbcType=VARCHAR},
            </if>
            <if test="appUntilObj != null and appUntilObj.appStatus !=null ">
                #{appUntilObj.appStatus,jdbcType=BIGINT},
            </if>
            <if test="onsaleDate != null">
                #{onsaleDate,jdbcType=TIMESTAMP},
            </if>
            <if test="offsaleDate != null">
                #{offsaleDate,jdbcType=TIMESTAMP},
            </if>
            <if test="appUntilObj != null and appUntilObj.appType !=null">
                #{appUntilObj.appType ,jdbcType=BIGINT},
            </if>
            <if test="appCategorylevel3 != null and appCategorylevel3.id !=null">
                #{appCategorylevel3.id,jdbcType=BIGINT},
            </if>
            <if test="downLoads != null">
                #{downLoads,jdbcType=BIGINT},
            </if>
            <if test="devUser != null and devUser.id !=null">
                #{devUser.id,jdbcType=BIGINT},
            </if>
            <if test="creationDate != null">
                #{creationDate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifyBy != null">
                #{modifyBy,jdbcType=BIGINT},
            </if>
            <if test="modifyDatee != null">
                #{modifyDatee,jdbcType=TIMESTAMP},
            </if>
            <if test="appCategorylevel1 != null and appCategorylevel1.id !=null">
                #{appCategorylevel1.id ,jdbcType=BIGINT},
            </if>
            <if test="appCategorylevel2 !=null and appCategorylevel2.id  != null">
                #{appCategorylevel2.id,jdbcType=BIGINT},
            </if>
            <if test="logopicPath != null">
                #{logopicPath,jdbcType=VARCHAR},
            </if>
            <if test="logolocPath != null">
                #{logolocPath,jdbcType=VARCHAR},
            </if>
            <if test="newAppVersion != null and newAppVersion.id !=null">
                #{newAppVersion.id,jdbcType=BIGINT},
            </if>
        </trim>
    </insert>
    <delete id="deleteByPrimaryKey" >
        delete from app_info
        <where>
            <if test="id !=null">
                id = #{id,jdbcType=BIGINT}
            </if>
        </where>
    </delete>


    <select id="queryDetail" resultMap="appInfoWithHistory" parameterType="java.lang.Long">
   select  t1.id as appId, t1.software_name, t1.apk_name, t1.support_trom, t1.interface_language, t1.software_size, t1.update_date, t1.logoloc_path,t1.logopic_path,t1.creation_date,
     t1.app_info,t1.onsale_date, t1.offsale_date, t1.down_loads,t1.`status`,t1.flatfrom_id,
		c1.id as levelOneId,c2.id levelTwoId,c3.id levelThreeId,
		c1.category_name levelName1,c2.category_name levelName2,c3.category_name levelName3,
		d1.value_id statuId,d1.value_name statuName,
		d2.value_id flatfromId,d2.value_name flatfromName,
		v1.id as versionId,v1.version_no,
		u1.id createId,u1.devName createName,
		u2.id modifyId,u2.devName modifyName,
		u3.id devId , u3.devName devName,
		v2.id as historyId,v2.version_no as historyVersionNo,
		v2.version_info as historyVersioinInfo,v2.publish_status as historyPublishStatus ,v2.version_size as historyVersionSize,
		v2.downLoad_link as historyDownLoadLink,v2.apkLoc_path as historyapkLocPath,v2.apk_filename as historyApkFileName
		from app_info t1 LEFT JOIN app_category c1 on t1.category_level1 = c1.id
		LEFT JOIN app_category c2 on t1.category_level2 =c2.id
		LEFT JOIN app_category c3 on t1.category_level3=c3.id
		LEFT JOIN data_dictionary d1 on t1.`status` = d1.value_id
		LEFT JOIN data_dictionary d2 on t1.flatfrom_id = d2.value_id
		LEFT JOIN app_version v1 on t1.version_id = v1.version_no
		LEFT JOIN dev_user u1 on t1.created_by = u1.id
		LEFT JOIN dev_user u2 on t1.modify_by = u2.id
		LEFT JOIN dev_user u3 on t1.dev_id = u3.id
		LEFT JOIN app_version v2 on t1.id = v2.app_id
		where t1.id =48 and d1.type_code='APP_STATUS' and d2.type_code='APP_FLATORM'
    </select>
    <update id="updateByPrimaryKeySelective" parameterType="com.sz.pojo.AppInfo">
        update app_info
        <set>
            <if test="softwareName != null">
                software_name = #{softwareName,jdbcType=VARCHAR},
            </if>
            <if test="apkName != null">
                apk_name = #{apkName,jdbcType=VARCHAR},
            </if>
            <if test="supportTrom != null">
                support_trom = #{supportTrom,jdbcType=VARCHAR},
            </if>
            <if test="interfaceLanguage != null">
                interface_language = #{interfaceLanguage,jdbcType=VARCHAR},
            </if>
            <if test="softwareSize != null">
                software_size = #{softwareSize,jdbcType=DECIMAL},
            </if>
            <if test="updateDate != null">
                update_date = #{updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="devId != null">
                dev_id = #{devId,jdbcType=BIGINT},
            </if>
            <if test="appInfo != null">
                app_info = #{appInfo,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                status = #{appUntilObj.appStatus,jdbcType=BIGINT},
            </if>
            <if test="onsaleDate != null">
                onsale_date = #{onsaleDate,jdbcType=TIMESTAMP},
            </if>
            <if test="offsaleDate != null">
                offsale_date = #{offsaleDate,jdbcType=TIMESTAMP},
            </if>
            <if test="flatfromId != null">
                flatfrom_id = #{appUntilObj.appType,jdbcType=BIGINT},
            </if>
            <if test="appCategorylevel3.id != null">
                category_level3 = #{appCategorylevel3.id,jdbcType=BIGINT},
            </if>
            <if test="downLoads != null">
                down_loads = #{downLoads,jdbcType=BIGINT},
            </if>
            <if test="createdBy != null">
                created_by = #{createdBy,jdbcType=BIGINT},
            </if>
            <if test="creationDate != null">
                creation_date = #{creationDate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifyBy != null">
                modify_by = #{modifyBy,jdbcType=BIGINT},
            </if>
            <if test="modifyDatee != null">
                modify_datee = #{modifyDatee,jdbcType=TIMESTAMP},
            </if>
            <if test="appCategorylevel1.id != null">
                category_level1 = #{appCategorylevel1.id,jdbcType=BIGINT},
            </if>
            <if test="appCategorylevel2.id != null">
                category_level2 = #{appCategorylevel2.id,jdbcType=BIGINT},
            </if>
            <if test="logopicPath != null">
                logopic_path = #{logopicPath,jdbcType=VARCHAR},
            </if>
            <if test="logolocPath != null">
                logoloc_path = #{logolocPath,jdbcType=VARCHAR},
            </if>
            <if test="newAppVersion.versionNo != null">
                version_id = #{newAppVersion.id,jdbcType=BIGINT},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
</mapper>